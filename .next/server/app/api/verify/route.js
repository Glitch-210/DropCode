"use strict";(()=>{var e={};e.id=976,e.ids=[976],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:e=>{e.exports=require("fs")},4448:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>m,originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>h});var o={};r.r(o),r.d(o,{GET:()=>d,PATCH:()=>p});var i=r(5419),a=r(9108),n=r(9678),s=r(8070),l=r(2982);async function d(e){let{searchParams:t}=new URL(e.url),r=t.get("code");if(!r)return s.Z.json({error:"Code required"},{status:400});let o=l.h.get(r);return o?Date.now()>o.expiresAt?(l.h.remove(r),s.Z.json({error:"File expired"},{status:404})):s.Z.json({code:o.code,originalName:o.originalName,size:o.size,mimeType:o.files[0].mimeType,expiresAt:o.expiresAt,fileCount:o.files.length,expiryMinutes:o.expiryMinutes,maxDownloads:o.maxDownloads===1/0?"Unlimited":o.maxDownloads,downloads:o.downloads}):s.Z.json({error:"File not found or expired"},{status:404})}async function p(e){try{let{code:t,expiryMinutes:r,maxDownloads:o}=await e.json();if(!t)return s.Z.json({error:"Code required"},{status:400});let i=l.h.get(t);if(!i)return s.Z.json({error:"File not found or expired"},{status:404});if(void 0!==r){let e=parseInt(r);[5,10,30].includes(e)&&(i.expiryMinutes=e,i.expiresAt=i.uploadedAt+6e4*e)}if(void 0!==o){if("Infinity"===o||null===o)i.maxDownloads=1/0;else{let e=parseInt(o);!isNaN(e)&&e>0&&(i.maxDownloads=e)}}return l.h.save(t,i),s.Z.json({code:i.code,expiresAt:i.expiresAt,expiryMinutes:i.expiryMinutes,maxDownloads:i.maxDownloads===1/0?"Unlimited":i.maxDownloads,downloads:i.downloads})}catch(e){return s.Z.json({error:"Invalid request"},{status:400})}}let u=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/verify/route",pathname:"/api/verify",filename:"route",bundlePath:"app/api/verify/route"},resolvedPagePath:"X:\\projects\\DropCode\\app\\api\\verify\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:f,serverHooks:x,headerHooks:m,staticGenerationBailout:h}=u,v="/api/verify/route";function y(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},2982:(e,t,r)=>{r.d(t,{h:()=>n});var o=r(7147),i=r.n(o);let a=global.fileStore||new Map;global.fileStore=a;let n={save(e,t){a.set(e.toUpperCase(),t)},get:e=>a.get(e.toUpperCase())||null,remove(e){a.delete(e.toUpperCase())},cleanup(){let e=Date.now(),t=0;for(let[r,o]of a.entries())e>o.expiresAt&&((o.files||[o]).forEach(e=>{try{e.path&&i().existsSync(e.path)&&i().unlinkSync(e.path)}catch(t){console.error(`Failed to delete file ${e.path}:`,t)}}),a.delete(r),t++);t>0&&console.log(`Cleanup: Removed ${t} expired files`)}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[638,206],()=>r(4448));module.exports=o})();