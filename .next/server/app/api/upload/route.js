"use strict";(()=>{var e={};e.id=998,e.ids=[998],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},773:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>C,patchFetch:()=>F,requestAsyncStorage:()=>S,routeModule:()=>y,serverHooks:()=>j,staticGenerationAsyncStorage:()=>A,staticGenerationBailout:()=>M});var o={};r.r(o),r.d(o,{POST:()=>v,runtime:()=>x});var a=r(5419),i=r(9108),n=r(9678),l=r(8070),s=r(2982);function u(e=5){let t="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",r="";for(let o=0;o<e;o++)r+=t.charAt(Math.floor(Math.random()*t.length));return r}let p={MAX_FILE_SIZE:209715200};var d=r(1017),f=r.n(d),c=r(7147),h=r.n(c);let g=require("os");var m=r.n(g);let x="nodejs";async function v(e){try{let t=(await e.formData()).getAll("files");if(!t||0===t.length)return l.Z.json({error:"No files uploaded"},{status:400});let r=u(),o=0;for(;s.h.get(r)&&o<5;)r=u(),o++;if(s.h.get(r))return l.Z.json({error:"Failed to generate unique code"},{status:503});let a=f().join(m().tmpdir(),"uploads");h().existsSync(a)||h().mkdirSync(a,{recursive:!0});let i=[],n=0;for(let e of t){if(e.size>p.MAX_FILE_SIZE)return l.Z.json({error:"File too large"},{status:413});let t=Buffer.from(await e.arrayBuffer()),r=`${Date.now()}-${Math.random().toString(36).substring(7)}-${e.name}`,o=f().join(a,r);h().writeFileSync(o,t),i.push({originalName:e.name,mimeType:e.type,size:e.size,path:o}),n+=e.size}let d=1===i.length?i[0].originalName:`${i.length} files`,c=Date.now(),g={code:r,files:i,originalName:d,size:n,uploadedAt:c,expiryMinutes:10,expiresAt:c+6e5,downloads:0,maxDownloads:1/0};return s.h.save(r,g),l.Z.json({code:r,expiresAt:g.expiresAt,originalName:d,size:n,fileCount:i.length})}catch(e){return console.error("Upload Error:",e),l.Z.json({error:"Upload failed: "+e.message},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"X:\\projects\\DropCode\\app\\api\\upload\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:S,staticGenerationAsyncStorage:A,serverHooks:j,headerHooks:w,staticGenerationBailout:M}=y,C="/api/upload/route";function F(){return(0,n.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:A})}},2982:(e,t,r)=>{r.d(t,{h:()=>n});var o=r(7147),a=r.n(o);let i=global.fileStore||new Map;global.fileStore=i;let n={save(e,t){i.set(e.toUpperCase(),t)},get:e=>i.get(e.toUpperCase())||null,remove(e){i.delete(e.toUpperCase())},cleanup(){let e=Date.now(),t=0;for(let[r,o]of i.entries())e>o.expiresAt&&((o.files||[o]).forEach(e=>{try{e.path&&a().existsSync(e.path)&&a().unlinkSync(e.path)}catch(t){console.error(`Failed to delete file ${e.path}:`,t)}}),i.delete(r),t++);t>0&&console.log(`Cleanup: Removed ${t} expired files`)}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[638,206],()=>r(773));module.exports=o})();